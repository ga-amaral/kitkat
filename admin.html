<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatil - Área Administrativa</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #262626;
            margin-bottom: 2rem;
            border-radius: 8px;
            color: white;
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-user-info i {
            font-size: 1.5rem;
            color: rgb(224,190,82);
        }

        .admin-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            background-color: black;
        }

        .admin-section {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(224,190,82,0.1);
            border: 1px solid rgba(224,190,82,0.2);
        }

        .admin-section h2 {
            color: rgb(224,190,82);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-section h2 i {
            color: rgb(224,190,82);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgb(0, 0, 0);
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(224,190,82,0.2);
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
            color: #262626;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgb(224,190,82);
        }

        .btn-admin {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-admin:hover {
            background-color: rgb(201,171,74);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            color: white;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(224,190,82,0.2);
        }

        .admin-table th {
            background-color: #262626;
            font-weight: bold;
        }

        .admin-table tr:hover {
            background-color: #262626;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-edit,
        .btn-delete {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .btn-edit {
            background-color: rgb(224,190,82);
            color: black;
        }

        .btn-delete {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.5rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-edit:hover {
            background-color: rgb(201,171,74);
        }

        .btn-excluir {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.5rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f8f9fa;
            color: #333;
            font-weight: bold;
        }

        .tab-button.active {
            background-color: rgb(224,190,82);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .card {
            background: #262626;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: white;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-editar {
            background-color: #ffc107;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-editar:hover {
            background-color: #e0a800;
        }

        .form-section {
            background: #262626;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            color: white;
        }

        .success-message {
            color: rgb(224,190,82);
            background-color: rgba(224,190,82,0.1);
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-disponivel {
            background-color: #28a745;
            color: white;
        }

        .status-vendido {
            background-color: #dc3545;
            color: white;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: black;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            accent-color: rgb(224,190,82);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .tag {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            background-color: #1a1a1a;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .tag i {
            font-size: 0.7rem;
            color: rgb(224,190,82);
        }

        .tag-saude {
            color: rgb(224,190,82);
        }

        .tag-personalidade {
            color: rgb(224,190,82);
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .popup-content {
            background-color: #1a1a1a;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            color: white;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .popup-header h2 {
            margin: 0;
            color: rgb(224,190,82);
        }

        .btn-fechar {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        .btn-fechar:hover {
            color: rgb(224,190,82);
        }

        .popup-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-cancelar {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-cancelar:hover {
            background-color: #5a6268;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        .logo-container img {
            max-height: 100px;
            width: auto;
        }

        .padreador-premios {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #333;
        }

        .padreador-premios h4 {
            margin: 0 0 0.8rem 0;
            color: white;
            font-size: 1rem;
            font-weight: bold;
        }

        .padreador-premios ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .padreador-premios li {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            color: white;
        }

        .padreador-premios li i {
            color: rgb(224,190,82);
            width: 16px;
            text-align: center;
        }

        .usuario-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .usuario-info i {
            color: rgb(224,190,82);
            font-size: 1.5rem;
        }

        body {
            opacity: 1;
            visibility: visible;
        }

        /* Criar um overlay de carregamento */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-spinner {
            color: rgb(224,190,82);
            font-size: 2rem;
        }

        .linhagem-info {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(224,190,82,0.2);
        }

        .linhagem-info h4 {
            color: rgb(224,190,82);
            margin: 0 0 0.5rem 0;
        }

        .linhagem-info p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
            color: white;
        }

        .mensagem-vazio {
            width: 100%;
            text-align: center;
            padding: 2rem;
            color: #999;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <!-- Adicionar overlay de carregamento -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
    </div>

    <header>
        <div class="logo-container">
            <img src="./img/logo.png" alt="Logo do Gatil">
        </div>
        <button class="menu-toggle" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <nav>
            <ul>
                <li><a href="index.html">Nossos Gatos</a></li>
                <li><a href="matrizes.html">Matrizes</a></li>
                <li><a href="padreadores.html">Padreadores</a></li>
                <li><a href="vendidos.html">Vendidos</a></li>
                <li><a href="contato.html">Sobre & Contato</a></li>
                <li><a href="login.html"><i class="fas fa-user-lock"></i> Área Admin</a></li>
            </ul>
        </nav>
        <div class="menu-overlay"></div>
    </header>

    <main>
        <div class="admin-container">
            <div class="admin-header">
                <div class="admin-user-info">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <h3 id="usuario-nome">Administrador</h3>
                        <small id="usuario-tipo">Administrador</small>
                    </div>
                </div>
                <button id="btn-logout" class="btn-excluir">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>

            <div class="admin-tabs">
                <button class="tab-button active" data-tab="gatos">
                    <i class="fas fa-cat"></i> Gatos
                </button>
                <button class="tab-button" data-tab="matrizes">
                    <i class="fas fa-venus"></i> Matrizes
                </button>
                <button class="tab-button" data-tab="padreadores">
                    <i class="fas fa-mars"></i> Padreadores
                </button>
                <button class="tab-button" data-tab="usuarios">
                    <i class="fas fa-users"></i> Usuários
                </button>
            </div>

            <!-- Aba de Gatos -->
            <div id="gatos" class="tab-content active">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Novo Gato</h2>
                    <div id="gato-success" class="success-message">
                        Gato cadastrado com sucesso!
                    </div>
                    <form id="form-novo-gato" class="form-contato">
                        <div class="form-group">
                            <label for="gato-nome">Nome:</label>
                            <input type="text" id="gato-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="gato-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-cor">Cor:</label>
                            <input type="text" id="gato-cor" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-foto">URL da Foto:</label>
                            <input type="text" id="gato-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-descricao">Descrição:</label>
                            <textarea id="gato-descricao" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="gato-status">Status:</label>
                            <select id="gato-status" required>
                                <option value="disponivel">Disponível</option>
                                <option value="vendido">Vendido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gato-mae">Matriz:</label>
                            <select id="gato-mae" required></select>
                        </div>
                        <div class="form-group">
                            <label for="gato-pai">Padreador:</label>
                            <select id="gato-pai" required></select>
                        </div>
                        <div class="form-group">
                            <label>Tags de Saúde:</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="tag-vacinado" checked> Vacinado
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-vermifugado" checked> Vermifugado
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-microchipado" checked> Testado FIV/FeLV
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-castrado"> Castrado
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Personalidade:</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="tag-docil"> Dócil
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-brincalhao"> Brincalhão
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-sociavel"> Sociável
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-calmo"> Calmo
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-independente"> Independente
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Gato</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Gatos Cadastrados</h2>
                <div id="gatos-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Matrizes -->
            <div id="matrizes" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Nova Matriz</h2>
                    <div id="matriz-success" class="success-message">
                        Matriz cadastrada com sucesso!
                    </div>
                    <form id="form-nova-matriz" class="form-contato">
                        <div class="form-group">
                            <label for="matriz-nome">Nome:</label>
                            <input type="text" id="matriz-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="matriz-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-raca">Raça:</label>
                            <input type="text" id="matriz-raca" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-ninhadas">Ninhadas:</label>
                            <input type="number" id="matriz-ninhadas" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-caracteristicas">Características dos Filhotes:</label>
                            <textarea id="matriz-caracteristicas" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="matriz-foto">URL da Foto:</label>
                            <input type="text" id="matriz-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-linhagem">Linhagem:</label>
                            <textarea id="matriz-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Matriz</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Matrizes Cadastradas</h2>
                <div id="matrizes-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Padreadores -->
            <div id="padreadores" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Novo Padreador</h2>
                    <div id="padreador-success" class="success-message">
                        Padreador cadastrado com sucesso!
                    </div>
                    <form id="form-novo-padreador" class="form-contato">
                        <div class="form-group">
                            <label for="padreador-nome">Nome:</label>
                            <input type="text" id="padreador-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="padreador-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-raca">Raça:</label>
                            <input type="text" id="padreador-raca" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-caracteristicas">Características dos Filhotes:</label>
                            <textarea id="padreador-caracteristicas" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="padreador-foto">URL da Foto:</label>
                            <input type="text" id="padreador-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-linhagem">Linhagem:</label>
                            <textarea id="padreador-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Padreador</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Padreadores Cadastrados</h2>
                <div id="padreadores-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Usuários -->
            <div id="usuarios" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-user-plus"></i> Novo Usuário</h2>
                    <div id="usuario-success" class="success-message">
                        Usuário cadastrado com sucesso!
                    </div>
                    <form id="form-novo-usuario" class="form-contato">
                        <div class="form-group">
                            <label for="novo-nome">Nome:</label>
                            <input type="text" id="novo-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-username">Usuário:</label>
                            <input type="text" id="novo-username" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-password">Senha:</label>
                            <input type="password" id="novo-password" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-tipo">Tipo:</label>
                            <select id="novo-tipo" required>
                                <option value="admin">Administrador</option>
                                <option value="usuario">Usuário</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Usuário</button>
                    </form>
                </div>
                <h2><i class="fas fa-users"></i> Usuários Cadastrados</h2>
                <div id="usuarios-grid" class="grid-container"></div>
            </div>
        </div>
    </main>

    <!-- Popup de Edição -->
    <div id="popup-editar" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Gato</h2>
                <button class="btn-fechar" onclick="fecharPopupEditar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-gato" class="form-contato">
                <input type="hidden" id="editar-gato-id">
                <div class="form-group">
                    <label for="editar-gato-nome">Nome:</label>
                    <input type="text" id="editar-gato-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-gato-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-cor">Cor:</label>
                    <input type="text" id="editar-gato-cor" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-foto">URL da Foto:</label>
                    <input type="text" id="editar-gato-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-descricao">Descrição:</label>
                    <textarea id="editar-gato-descricao" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-gato-status">Status:</label>
                    <select id="editar-gato-status" required>
                        <option value="disponivel">Disponível</option>
                        <option value="vendido">Vendido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editar-gato-mae">Matriz:</label>
                    <select id="editar-gato-mae" required></select>
                </div>
                <div class="form-group">
                    <label for="editar-gato-pai">Padreador:</label>
                    <select id="editar-gato-pai" required></select>
                </div>
                <div class="form-group">
                    <label>Tags de Saúde:</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="editar-tag-vacinado"> Vacinado
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-vermifugado"> Vermifugado
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-microchipado"> Testado FIV/FeLV
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-castrado"> Castrado
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Personalidade:</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="editar-tag-docil"> Dócil
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-brincalhao"> Brincalhão
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-sociavel"> Sociável
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-calmo"> Calmo
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-independente"> Independente
                        </label>
                    </div>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditar()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup de Edição de Matriz -->
    <div id="popup-editar-matriz" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Matriz</h2>
                <button class="btn-fechar" onclick="fecharPopupEditarMatriz()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-matriz" class="form-contato">
                <input type="hidden" id="editar-matriz-id">
                <div class="form-group">
                    <label for="editar-matriz-nome">Nome:</label>
                    <input type="text" id="editar-matriz-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-matriz-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-raca">Raça:</label>
                    <input type="text" id="editar-matriz-raca" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-ninhadas">Ninhadas:</label>
                    <input type="number" id="editar-matriz-ninhadas" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-caracteristicas">Características dos Filhotes:</label>
                    <textarea id="editar-matriz-caracteristicas" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-foto">URL da Foto:</label>
                    <input type="text" id="editar-matriz-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-linhagem">Linhagem:</label>
                    <textarea id="editar-matriz-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditarMatriz()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup de Edição de Padreador -->
    <div id="popup-editar-padreador" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Padreador</h2>
                <button class="btn-fechar" onclick="fecharPopupEditarPadreador()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-padreador" class="form-contato">
                <input type="hidden" id="editar-padreador-id">
                <div class="form-group">
                    <label for="editar-padreador-nome">Nome:</label>
                    <input type="text" id="editar-padreador-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-padreador-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-raca">Raça:</label>
                    <input type="text" id="editar-padreador-raca" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-caracteristicas">Características dos Filhotes:</label>
                    <textarea id="editar-padreador-caracteristicas" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-foto">URL da Foto:</label>
                    <input type="text" id="editar-padreador-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-linhagem">Linhagem:</label>
                    <textarea id="editar-padreador-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditarPadreador()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Zaidan Gatil. Todos os direitos reservados.</p>
    </footer>

    <script src="menu.js"></script>
    <script>
        // Variáveis globais para armazenar dados
        let matrizes = [];
        let padreadores = [];
        let gatos = [];
        let sessaoVerificada = false;

        // Função para verificar a sessão apenas uma vez
        async function verificarSessao() {
            if (sessaoVerificada) return true;
            
            try {
                const response = await fetch('verificar_sessao.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate'
                    }
                });
                
                const data = await response.json();
                
                if (data.logado) {
                    document.getElementById('usuario-nome').textContent = data.nome || 'Administrador';
                    document.getElementById('usuario-tipo').textContent = data.tipo || 'Administrador';
                    sessaoVerificada = true;
                    return true;
                } else {
                    window.location.href = 'login.html';
                    return false;
                }
            } catch (error) {
                console.error('Erro ao verificar sessão:', error);
                return false;
            }
        }

        // Função para debounce (limitar a frequência de chamadas)
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }

        // Versões com debounce das funções de atualização
        const atualizarListaGatosDebounced = debounce(atualizarListaGatos, 300);
        const atualizarListaMatrizesDebounced = debounce(atualizarListaMatrizes, 300);
        const atualizarListaPadreadoresDebounced = debounce(atualizarListaPadreadores, 300);

        // Função para preencher os selects de matrizes e padreadores
        function preencherSelectsPais() {
            // Selects do formulário de cadastro
            const selectMae = document.getElementById('gato-mae');
            const selectPai = document.getElementById('gato-pai');
            
            // Selects do formulário de edição
            const selectMaeEdit = document.getElementById('editar-gato-mae');
            const selectPaiEdit = document.getElementById('editar-gato-pai');
            
            // Limpa os selects
            selectMae.innerHTML = '<option value="">Selecione uma matriz</option>';
            selectPai.innerHTML = '<option value="">Selecione um padreador</option>';
            
            if (selectMaeEdit && selectPaiEdit) {
                selectMaeEdit.innerHTML = '<option value="">Selecione uma matriz</option>';
                selectPaiEdit.innerHTML = '<option value="">Selecione um padreador</option>';
            }
            
            // Preenche o select de matrizes
            matrizes.forEach(matriz => {
                const option = `<option value="${matriz.id}">${matriz.nome} (${matriz.raca})</option>`;
                selectMae.innerHTML += option;
                if (selectMaeEdit) selectMaeEdit.innerHTML += option;
            });
            
            // Preenche o select de padreadores
            padreadores.forEach(padreador => {
                const option = `<option value="${padreador.id}">${padreador.nome} (${padreador.raca})</option>`;
                selectPai.innerHTML += option;
                if (selectPaiEdit) selectPaiEdit.innerHTML += option;
            });
        }

        // Função para configurar as abas
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // Atualizar botões
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Atualizar conteúdo
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        // Função para mostrar/esconder o indicador de carregamento
        function toggleLoading(show) {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = show ? 'flex' : 'none';
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', async function() {
            // Esconde o overlay de carregamento
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
            
            // Verifica a sessão antes de carregar os dados
            const sessaoValida = await verificarSessao();
            if (!sessaoValida) return;
            
            toggleLoading(true);
            try {
                // Carrega os dados iniciais em paralelo
                await Promise.all([
                    atualizarListaGatos(),
                    atualizarListaMatrizes(),
                    atualizarListaPadreadores(),
                    atualizarListaUsuarios()
                ]);
                
                // Preenche os selects de matrizes e padreadores
                preencherSelectsPais();
                
                // Configura as abas
                setupTabs();
                
                // Configura o botão de logout
                document.getElementById('btn-logout').addEventListener('click', async function() {
                    try {
                        // Primeiro, limpa o sessionStorage para evitar redirecionamento automático
                        sessionStorage.removeItem('usuario');
                        
                        const response = await fetch('logout.php', {
                            method: 'POST',
                            credentials: 'include',
                            headers: {
                                'Accept': 'application/json',
                                'Cache-Control': 'no-cache, no-store, must-revalidate'
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            // Definir sessaoVerificada como false para evitar verificações automáticas
                            sessaoVerificada = false;
                            
                            // Redirecionar para a página de login
                            window.location.replace('login.html');
                        }
                    } catch (error) {
                        console.error('Erro ao fazer logout:', error);
                    }
                });
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                alert('Erro ao carregar dados iniciais: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        });

        window.fecharPopupEditar = function() {
            document.getElementById('popup-editar').style.display = 'none';
        };

        // Evento de submit do formulário de edição
        document.getElementById('form-editar-gato').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            // Obter tags de saúde
            const tagsSaude = [];
            if (document.getElementById('editar-tag-vacinado').checked) tagsSaude.push('Vacinado');
            if (document.getElementById('editar-tag-vermifugado').checked) tagsSaude.push('Vermifugado');
            if (document.getElementById('editar-tag-microchipado').checked) tagsSaude.push('Testado FIV/FeLV');
            if (document.getElementById('editar-tag-castrado').checked) tagsSaude.push('Castrado');
            
            // Obter tags de personalidade
            const tagsPersonalidade = [];
            if (document.getElementById('editar-tag-docil').checked) tagsPersonalidade.push('Dócil');
            if (document.getElementById('editar-tag-brincalhao').checked) tagsPersonalidade.push('Brincalhão');
            if (document.getElementById('editar-tag-sociavel').checked) tagsPersonalidade.push('Sociável');
            if (document.getElementById('editar-tag-calmo').checked) tagsPersonalidade.push('Calmo');
            if (document.getElementById('editar-tag-independente').checked) tagsPersonalidade.push('Independente');
            
            const gatoAtualizado = {
                id: document.getElementById('editar-gato-id').value,
                nome: document.getElementById('editar-gato-nome').value,
                data_nascimento: document.getElementById('editar-gato-data-nascimento').value,
                cor: document.getElementById('editar-gato-cor').value,
                foto: document.getElementById('editar-gato-foto').value,
                descricao: document.getElementById('editar-gato-descricao').value,
                status: document.getElementById('editar-gato-status').value,
                matriz_id: document.getElementById('editar-gato-mae').value,
                padreador_id: document.getElementById('editar-gato-pai').value,
                tags_saude: tagsSaude,
                tags_personalidade: tagsPersonalidade
            };

            try {
                const response = await fetch('editar_gato.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(gatoAtualizado)
                });

                const data = await response.json();
                
                if (data.success) {
                    fecharPopupEditar();
                    await atualizarListaGatosDebounced();
                } else {
                    alert(data.message || 'Erro ao atualizar gato');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar gato');
            } finally {
                toggleLoading(false);
            }
        });

        // Fechar popup ao clicar fora
        document.getElementById('popup-editar').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditar();
            }
        });

        // Função para fechar o popup de edição de matriz
        window.fecharPopupEditarMatriz = function() {
            document.getElementById('popup-editar-matriz').style.display = 'none';
        };

        // Função para editar gato
        window.editarGato = function(id) {
            toggleLoading(true);
            
            fetch(`buscar_gato.php?id=${id}`, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const gato = data.gato;
                    
                    document.getElementById('editar-gato-id').value = gato.id;
                    document.getElementById('editar-gato-nome').value = gato.nome;
                    document.getElementById('editar-gato-data-nascimento').value = gato.data_nascimento;
                    document.getElementById('editar-gato-cor').value = gato.cor;
                    document.getElementById('editar-gato-foto').value = gato.foto;
                    document.getElementById('editar-gato-descricao').value = gato.descricao || '';
                    document.getElementById('editar-gato-status').value = gato.status || 'disponivel';
                    document.getElementById('editar-gato-mae').value = gato.matriz_id || '';
                    document.getElementById('editar-gato-pai').value = gato.padreador_id || '';

                    // Marcar checkboxes de saúde
                    document.getElementById('editar-tag-vacinado').checked = gato.tags_saude?.includes('Vacinado');
                    document.getElementById('editar-tag-vermifugado').checked = gato.tags_saude?.includes('Vermifugado');
                    document.getElementById('editar-tag-microchipado').checked = gato.tags_saude?.includes('Testado FIV/FeLV');
                    document.getElementById('editar-tag-castrado').checked = gato.tags_saude?.includes('Castrado');

                    // Marcar checkboxes de personalidade
                    document.getElementById('editar-tag-docil').checked = gato.tags_personalidade?.includes('Dócil');
                    document.getElementById('editar-tag-brincalhao').checked = gato.tags_personalidade?.includes('Brincalhão');
                    document.getElementById('editar-tag-sociavel').checked = gato.tags_personalidade?.includes('Sociável');
                    document.getElementById('editar-tag-calmo').checked = gato.tags_personalidade?.includes('Calmo');
                    document.getElementById('editar-tag-independente').checked = gato.tags_personalidade?.includes('Independente');

                    // Mostrar o popup
                    document.getElementById('popup-editar').style.display = 'block';
                } else {
                    alert(data.message || 'Erro ao buscar dados do gato');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao buscar dados do gato');
            })
            .finally(() => {
                toggleLoading(false);
            });
        };

        // Função para editar matriz
        window.editarMatriz = function(id) {
            toggleLoading(true);
            
            fetch(`buscar_matriz.php?id=${id}`, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao buscar dados da matriz');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    const matriz = data.matriz;
                    
                    document.getElementById('editar-matriz-id').value = matriz.id;
                    document.getElementById('editar-matriz-nome').value = matriz.nome;
                    document.getElementById('editar-matriz-data-nascimento').value = matriz.data_nascimento;
                    document.getElementById('editar-matriz-raca').value = matriz.raca;
                    document.getElementById('editar-matriz-ninhadas').value = matriz.ninhadas;
                    document.getElementById('editar-matriz-caracteristicas').value = matriz.caracteristicas;
                    document.getElementById('editar-matriz-foto').value = matriz.foto;
                    document.getElementById('editar-matriz-linhagem').value = matriz.linhagem;

                    document.getElementById('popup-editar-matriz').style.display = 'block';
                } else {
                    alert(data.message || 'Erro ao buscar dados da matriz');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao buscar dados da matriz');
            })
            .finally(() => {
                toggleLoading(false);
            });
        };

        // Evento de submit do formulário de edição de matriz
        document.getElementById('form-editar-matriz').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const matrizAtualizada = {
                id: document.getElementById('editar-matriz-id').value,
                nome: document.getElementById('editar-matriz-nome').value,
                data_nascimento: document.getElementById('editar-matriz-data-nascimento').value,
                raca: document.getElementById('editar-matriz-raca').value,
                ninhadas: document.getElementById('editar-matriz-ninhadas').value,
                caracteristicas: document.getElementById('editar-matriz-caracteristicas').value,
                foto: document.getElementById('editar-matriz-foto').value,
                linhagem: document.getElementById('editar-matriz-linhagem').value
            };

            try {
                const response = await fetch('editar_matriz.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(matrizAtualizada)
                });

                const data = await response.json();
                
                if (data.success) {
                    // Fecha o popup
                    fecharPopupEditarMatriz();
                    
                    // Recarrega a lista de matrizes
                    await atualizarListaMatrizesDebounced();
                    
                    alert('Matriz atualizada com sucesso!');
                } else {
                    alert(data.message || 'Erro ao atualizar matriz');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar matriz');
            } finally {
                toggleLoading(false);
            }
        });

        // Funções para o popup de edição de padreador
        window.editarPadreador = function(id) {
            toggleLoading(true);
            
            fetch(`buscar_padreador.php?id=${id}`, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const padreador = data.padreador;
                    
                    document.getElementById('editar-padreador-id').value = padreador.id;
                    document.getElementById('editar-padreador-nome').value = padreador.nome;
                    document.getElementById('editar-padreador-data-nascimento').value = padreador.data_nascimento;
                    document.getElementById('editar-padreador-raca').value = padreador.raca;
                    document.getElementById('editar-padreador-caracteristicas').value = padreador.caracteristicas;
                    document.getElementById('editar-padreador-foto').value = padreador.foto;
                    document.getElementById('editar-padreador-linhagem').value = padreador.linhagem;
                    
                    document.getElementById('popup-editar-padreador').style.display = 'block';
                } else {
                    alert(data.message || 'Erro ao buscar dados do padreador');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao buscar dados do padreador');
            })
            .finally(() => {
                toggleLoading(false);
            });
        };

        window.fecharPopupEditarPadreador = function() {
            document.getElementById('popup-editar-padreador').style.display = 'none';
        };

        // Evento de submit do formulário de edição de padreador
        document.getElementById('form-editar-padreador').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const padreadorAtualizado = {
                id: document.getElementById('editar-padreador-id').value,
                nome: document.getElementById('editar-padreador-nome').value,
                data_nascimento: document.getElementById('editar-padreador-data-nascimento').value,
                raca: document.getElementById('editar-padreador-raca').value,
                caracteristicas: document.getElementById('editar-padreador-caracteristicas').value,
                foto: document.getElementById('editar-padreador-foto').value,
                linhagem: document.getElementById('editar-padreador-linhagem').value
            };

            try {
                const response = await fetch('editar_padreador.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(padreadorAtualizado)
                });

                const data = await response.json();
                
                if (data.success) {
                    fecharPopupEditarPadreador();
                    await atualizarListaPadreadoresDebounced();
                } else {
                    alert(data.message || 'Erro ao atualizar padreador');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar padreador');
            } finally {
                toggleLoading(false);
            }
        });

        // Fechar popups ao clicar fora
        document.getElementById('popup-editar-matriz').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditarMatriz();
            }
        });

        document.getElementById('popup-editar-padreador').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditarPadreador();
            }
        });

        // Adicionar funções auxiliares para formatação de data e cálculo de idade
        function calcularIdade(dataNascimento) {
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            
            if (idade < 1) {
                const meses = idade * 12 + mes;
                return `${meses} meses`;
            }
            
            return `${idade} anos`;
        }

        function formatarData(data) {
            if (!data) return '';
            const d = new Date(data);
            return d.toLocaleDateString('pt-BR');
        }

        // Evento de submit do formulário de nova matriz
        document.getElementById('form-nova-matriz').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const novaMatriz = {
                nome: document.getElementById('matriz-nome').value,
                data_nascimento: document.getElementById('matriz-data-nascimento').value,
                raca: document.getElementById('matriz-raca').value,
                ninhadas: document.getElementById('matriz-ninhadas').value,
                caracteristicas: document.getElementById('matriz-caracteristicas').value,
                foto: document.getElementById('matriz-foto').value,
                linhagem: document.getElementById('matriz-linhagem').value
            };

            try {
                const response = await fetch('cadastrar_matriz.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate'
                    },
                    body: JSON.stringify(novaMatriz)
                });

                const responseText = await response.text();
                console.log('Resposta do servidor:', responseText);
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Erro ao fazer parse da resposta:', parseError);
                    throw new Error('Resposta inválida do servidor: ' + responseText);
                }
                
                if (data.success) {
                    // Limpa o formulário
                    e.target.reset();
                    
                    // Mostra mensagem de sucesso
                    document.getElementById('matriz-success').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('matriz-success').style.display = 'none';
                    }, 3000);
                    
                    // Recarrega a lista de matrizes
                    await atualizarListaMatrizesDebounced();
                } else {
                    alert(data.message || 'Erro ao cadastrar matriz');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar matriz: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        });

        // Evento de submit do formulário de novo padreador
        document.getElementById('form-novo-padreador').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const novoPadreador = {
                nome: document.getElementById('padreador-nome').value,
                data_nascimento: document.getElementById('padreador-data-nascimento').value,
                raca: document.getElementById('padreador-raca').value,
                caracteristicas: document.getElementById('padreador-caracteristicas').value,
                foto: document.getElementById('padreador-foto').value,
                linhagem: document.getElementById('padreador-linhagem').value
            };

            try {
                const response = await fetch('cadastrar_padreador.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate'
                    },
                    body: JSON.stringify(novoPadreador)
                });

                const responseText = await response.text();
                console.log('Resposta do servidor:', responseText);
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Erro ao fazer parse da resposta:', parseError);
                    throw new Error('Resposta inválida do servidor: ' + responseText);
                }
                
                if (data.success) {
                    // Limpa o formulário
                    e.target.reset();
                    
                    // Mostra mensagem de sucesso
                    document.getElementById('padreador-success').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('padreador-success').style.display = 'none';
                    }, 3000);
                    
                    // Recarrega a lista de padreadores
                    await atualizarListaPadreadoresDebounced();
                } else {
                    alert(data.message || 'Erro ao cadastrar padreador');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar padreador: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        });

        // Evento de submit do formulário de novo gato
        document.getElementById('form-novo-gato').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            // Coleta as tags de saúde marcadas
            const tagsSaude = [];
            if (document.getElementById('tag-vacinado').checked) tagsSaude.push('Vacinado');
            if (document.getElementById('tag-vermifugado').checked) tagsSaude.push('Vermifugado');
            if (document.getElementById('tag-microchipado').checked) tagsSaude.push('Testado FIV/FeLV');
            if (document.getElementById('tag-castrado').checked) tagsSaude.push('Castrado');
            
            // Coleta as tags de personalidade marcadas
            const tagsPersonalidade = [];
            if (document.getElementById('tag-docil').checked) tagsPersonalidade.push('Dócil');
            if (document.getElementById('tag-brincalhao').checked) tagsPersonalidade.push('Brincalhão');
            if (document.getElementById('tag-sociavel').checked) tagsPersonalidade.push('Sociável');
            if (document.getElementById('tag-calmo').checked) tagsPersonalidade.push('Calmo');
            if (document.getElementById('tag-independente').checked) tagsPersonalidade.push('Independente');
            
            const novoGato = {
                nome: document.getElementById('gato-nome').value,
                data_nascimento: document.getElementById('gato-data-nascimento').value,
                cor: document.getElementById('gato-cor').value,
                foto: document.getElementById('gato-foto').value,
                descricao: document.getElementById('gato-descricao').value,
                status: document.getElementById('gato-status').value,
                matriz_id: document.getElementById('gato-mae').value,
                padreador_id: document.getElementById('gato-pai').value,
                tags_saude: tagsSaude,
                tags_personalidade: tagsPersonalidade
            };

            try {
                const response = await fetch('cadastrar_gato.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate'
                    },
                    body: JSON.stringify(novoGato)
                });

                const responseText = await response.text();
                console.log('Resposta do servidor:', responseText);
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Erro ao fazer parse da resposta:', parseError);
                    throw new Error('Resposta inválida do servidor: ' + responseText);
                }
                
                if (data.success) {
                    // Limpa o formulário
                    e.target.reset();
                    
                    // Mostra mensagem de sucesso
                    document.getElementById('gato-success').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('gato-success').style.display = 'none';
                    }, 3000);
                    
                    // Recarrega a lista de gatos
                    await atualizarListaGatos();
                } else {
                    alert(data.message || 'Erro ao cadastrar gato');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar gato: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        });

        // Função para atualizar a lista de gatos
        async function atualizarListaGatos() {
            try {
                const response = await fetch('buscar_gatos.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const novosGatos = data.gatos || [];
                    
                    // Verifica se os dados são diferentes antes de atualizar o DOM
                    if (JSON.stringify(gatos) === JSON.stringify(novosGatos) && gatos.length > 0) {
                        return; // Não atualiza se os dados são iguais
                    }
                    
                    gatos = novosGatos;
                    
                    // Atualiza a grid de gatos
                    const gatosGrid = document.getElementById('gatos-grid');
                    
                    // Cria um fragmento para melhorar a performance
                    const fragment = document.createDocumentFragment();
                    
                    if (gatos.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.textContent = 'Nenhum gato cadastrado';
                        fragment.appendChild(mensagem);
                    } else {
                        gatos.forEach(gato => {
                            const card = document.createElement('div');
                            card.className = 'card';
                            
                            const statusClass = gato.status === 'disponivel' ? 'status-disponivel' : 'status-vendido';
                            const statusText = gato.status === 'disponivel' ? 'Disponível' : 'Vendido';
                            
                            card.innerHTML = `
                                <img src="${gato.foto}" alt="${gato.nome}">
                                <h3>${gato.nome}</h3>
                                <p><strong>Cor:</strong> ${gato.cor}</p>
                                <p><strong>Idade:</strong> ${calcularIdade(gato.data_nascimento)}</p>
                                <p><span class="status-badge ${statusClass}">${statusText}</span></p>
                                <div class="tags-container">
                                    ${gato.tags_saude?.map(tag => `<span class="tag tag-saude"><i class="fas fa-heart"></i> ${tag}</span>`).join('') || ''}
                                    ${gato.tags_personalidade?.map(tag => `<span class="tag tag-personalidade"><i class="fas fa-smile"></i> ${tag}</span>`).join('') || ''}
                                </div>
                                <div class="card-actions">
                                    <button class="btn-editar" onclick="editarGato(${gato.id})">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn-excluir" onclick="excluirGato(${gato.id})">
                                        <i class="fas fa-trash"></i> Excluir
                                    </button>
                                </div>
                            `;
                            
                            fragment.appendChild(card);
                        });
                    }
                    
                    // Limpa e adiciona o fragmento de uma vez só
                    gatosGrid.innerHTML = '';
                    gatosGrid.appendChild(fragment);
                } else {
                    console.error('Erro ao buscar gatos:', data.message);
                }
            } catch (error) {
                console.error('Erro ao buscar gatos:', error);
            }
        }
        
        // Função para atualizar a lista de matrizes
        async function atualizarListaMatrizes() {
            try {
                const response = await fetch('buscar_matrizes.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const novasMatrizes = data.matrizes || [];
                    
                    // Verifica se os dados são diferentes antes de atualizar o DOM
                    if (JSON.stringify(matrizes) === JSON.stringify(novasMatrizes) && matrizes.length > 0) {
                        return; // Não atualiza se os dados são iguais
                    }
                    
                    matrizes = novasMatrizes;
                    
                    // Atualiza a grid de matrizes
                    const matrizesGrid = document.getElementById('matrizes-grid');
                    
                    // Cria um fragmento para melhorar a performance
                    const fragment = document.createDocumentFragment();
                    
                    if (matrizes.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.textContent = 'Nenhuma matriz cadastrada';
                        fragment.appendChild(mensagem);
                    } else {
                        matrizes.forEach(matriz => {
                            const card = document.createElement('div');
                            card.className = 'card';
                            
                            card.innerHTML = `
                                <img src="${matriz.foto}" alt="${matriz.nome}">
                                <h3>${matriz.nome}</h3>
                                <p><strong>Raça:</strong> ${matriz.raca}</p>
                                <p><strong>Idade:</strong> ${calcularIdade(matriz.data_nascimento)}</p>
                                <p><strong>Ninhadas:</strong> ${matriz.ninhadas}</p>
                                <div class="linhagem-info">
                                    <h4>Linhagem</h4>
                                    <p>${matriz.linhagem || 'Não informada'}</p>
                                </div>
                                <div class="card-actions">
                                    <button class="btn-editar" onclick="editarMatriz(${matriz.id})">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn-excluir" onclick="excluirMatriz(${matriz.id})">
                                        <i class="fas fa-trash"></i> Excluir
                                    </button>
                                </div>
                            `;
                            
                            fragment.appendChild(card);
                        });
                    }
                    
                    // Limpa e adiciona o fragmento de uma vez só
                    matrizesGrid.innerHTML = '';
                    matrizesGrid.appendChild(fragment);
                } else {
                    console.error('Erro ao buscar matrizes:', data.message);
                }
            } catch (error) {
                console.error('Erro ao buscar matrizes:', error);
            }
        }
        
        // Função para atualizar a lista de padreadores
        async function atualizarListaPadreadores() {
            try {
                const response = await fetch('buscar_padreadores.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const novosPadreadores = data.padreadores || [];
                    
                    // Verifica se os dados são diferentes antes de atualizar o DOM
                    if (JSON.stringify(padreadores) === JSON.stringify(novosPadreadores) && padreadores.length > 0) {
                        return; // Não atualiza se os dados são iguais
                    }
                    
                    padreadores = novosPadreadores;
                    
                    // Atualiza a grid de padreadores
                    const padreadoresGrid = document.getElementById('padreadores-grid');
                    
                    // Cria um fragmento para melhorar a performance
                    const fragment = document.createDocumentFragment();
                    
                    if (padreadores.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.textContent = 'Nenhum padreador cadastrado';
                        fragment.appendChild(mensagem);
                    } else {
                        padreadores.forEach(padreador => {
                            const card = document.createElement('div');
                            card.className = 'card';
                            
                            card.innerHTML = `
                                <img src="${padreador.foto}" alt="${padreador.nome}">
                                <h3>${padreador.nome}</h3>
                                <p><strong>Raça:</strong> ${padreador.raca}</p>
                                <p><strong>Idade:</strong> ${calcularIdade(padreador.data_nascimento)}</p>
                                <div class="linhagem-info">
                                    <h4>Linhagem</h4>
                                    <p>${padreador.linhagem || 'Não informada'}</p>
                                </div>
                                <div class="card-actions">
                                    <button class="btn-editar" onclick="editarPadreador(${padreador.id})">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn-excluir" onclick="excluirPadreador(${padreador.id})">
                                        <i class="fas fa-trash"></i> Excluir
                                    </button>
                                </div>
                            `;
                            
                            fragment.appendChild(card);
                        });
                    }
                    
                    // Limpa e adiciona o fragmento de uma vez só
                    padreadoresGrid.innerHTML = '';
                    padreadoresGrid.appendChild(fragment);
                } else {
                    console.error('Erro ao buscar padreadores:', data.message);
                }
            } catch (error) {
                console.error('Erro ao buscar padreadores:', error);
            }
        }
        
        // Função para excluir gato
        window.excluirGato = function(id) {
            if (confirm('Tem certeza que deseja excluir este gato?')) {
                toggleLoading(true);
                
                fetch(`excluir_gato.php?id=${id}`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        atualizarListaGatos();
                    } else {
                        alert(data.message || 'Erro ao excluir gato');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao excluir gato');
                })
                .finally(() => {
                    toggleLoading(false);
                });
            }
        };
        
        // Função para excluir matriz
        window.excluirMatriz = function(id) {
            if (confirm('Tem certeza que deseja excluir esta matriz?')) {
                toggleLoading(true);
                
                fetch(`excluir_matriz.php?id=${id}`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        atualizarListaMatrizes();
                    } else {
                        alert(data.message || 'Erro ao excluir matriz');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao excluir matriz');
                })
                .finally(() => {
                    toggleLoading(false);
                });
            }
        };
        
        // Função para excluir padreador
        window.excluirPadreador = function(id) {
            if (confirm('Tem certeza que deseja excluir este padreador?')) {
                toggleLoading(true);
                
                fetch(`excluir_padreador.php?id=${id}`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        atualizarListaPadreadores();
                    } else {
                        alert(data.message || 'Erro ao excluir padreador');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao excluir padreador');
                })
                .finally(() => {
                    toggleLoading(false);
                });
            }
        };

        // Função para atualizar a lista de usuários
        async function atualizarListaUsuarios() {
            try {
                const response = await fetch('listar_usuarios.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const usuariosGrid = document.getElementById('usuarios-grid');
                    usuariosGrid.innerHTML = '';
                    
                    data.usuarios.forEach(usuario => {
                        const card = document.createElement('div');
                        card.className = 'card';
                        card.innerHTML = `
                            <h3>${usuario.name}</h3>
                            <p><strong>Usuário:</strong> ${usuario.user}</p>
                            <p><strong>Tipo:</strong> ${usuario.type}</p>
                            <div class="card-actions">
                                <button class="btn-delete" onclick="excluirUsuario(${usuario.id})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                        `;
                        usuariosGrid.appendChild(card);
                    });
                } else {
                    console.error('Erro ao carregar usuários:', data.message);
                }
            } catch (error) {
                console.error('Erro ao carregar usuários:', error);
            }
        }

        // Evento de submit do formulário de novo usuário
        document.getElementById('form-novo-usuario').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const nome = document.getElementById('novo-nome').value;
            const username = document.getElementById('novo-username').value;
            const password = document.getElementById('novo-password').value;
            const tipo = document.getElementById('novo-tipo').value;
            
            try {
                const response = await fetch('cadastrar_usuario.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        nome: nome,
                        username: username,
                        password: password,
                        tipo: tipo
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Limpa o formulário
                    document.getElementById('form-novo-usuario').reset();
                    
                    // Mostra mensagem de sucesso
                    const successMessage = document.getElementById('usuario-success');
                    successMessage.style.display = 'block';
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                    
                    // Atualiza a lista de usuários
                    await atualizarListaUsuarios();
                } else {
                    alert('Erro ao cadastrar usuário: ' + data.message);
                }
            } catch (error) {
                console.error('Erro ao cadastrar usuário:', error);
                alert('Erro ao cadastrar usuário: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        });

        // Função para excluir usuário
        window.excluirUsuario = async function(id) {
            if (!confirm('Tem certeza que deseja excluir este usuário?')) {
                return;
            }
            
            toggleLoading(true);
            
            try {
                const response = await fetch(`excluir_usuario.php?id=${id}`, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    await atualizarListaUsuarios();
                } else {
                    alert('Erro ao excluir usuário: ' + data.message);
                }
            } catch (error) {
                console.error('Erro ao excluir usuário:', error);
                alert('Erro ao excluir usuário: ' + error.message);
            } finally {
                toggleLoading(false);
            }
        };

        // Função para editar usuário
        window.editarUsuario = function(id) {
            alert('Funcionalidade de edição de usuário em desenvolvimento');
            // Aqui você pode implementar a lógica para abrir um popup de edição de usuário
        };
    </script>
</body>
</html>