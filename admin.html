<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatil - √Årea Administrativa</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: #262626;
            margin-bottom: 2rem;
            border-radius: 8px;
            color: white;
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-user-info i {
            font-size: 1.5rem;
            color: rgb(224,190,82);
        }

        .admin-container {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            background-color: black;
        }

        .admin-section {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(224,190,82,0.1);
            border: 1px solid rgba(224,190,82,0.2);
        }

        .admin-section h2 {
            color: rgb(224,190,82);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-section h2 i {
            color: rgb(224,190,82);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: rgb(0, 0, 0);
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(224,190,82,0.2);
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
            color: #262626;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgb(224,190,82);
        }

        .btn-admin {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-admin:hover {
            background-color: rgb(201,171,74);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            color: white;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(224,190,82,0.2);
        }

        .admin-table th {
            background-color: #262626;
            font-weight: bold;
        }

        .admin-table tr:hover {
            background-color: #262626;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-edit,
        .btn-delete {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .btn-edit {
            background-color: rgb(224,190,82);
            color: black;
        }

        .btn-delete {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.5rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-edit:hover {
            background-color: rgb(201,171,74);
        }

        .btn-excluir {
            background-color: rgb(224,190,82);
            color: black;
            padding: 0.5rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f8f9fa;
            color: #333;
            font-weight: bold;
        }

        .tab-button.active {
            background-color: rgb(224,190,82);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .card {
            background: #262626;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: white;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-editar {
            background-color: #ffc107;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-editar:hover {
            background-color: #e0a800;
        }

        .form-section {
            background: #262626;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            color: white;
        }

        .success-message {
            color: rgb(224,190,82);
            background-color: rgba(224,190,82,0.1);
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-disponivel {
            background-color: #28a745;
            color: white;
        }

        .status-vendido {
            background-color: #dc3545;
            color: white;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: black;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            accent-color: rgb(224,190,82);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .tag {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            background-color: #1a1a1a;
            border: 1px solid rgba(224,190,82,0.2);
        }

        .tag i {
            font-size: 0.7rem;
            color: rgb(224,190,82);
        }

        .tag-saude {
            color: rgb(224,190,82);
        }

        .tag-personalidade {
            color: rgb(224,190,82);
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .popup-content {
            background-color: #1a1a1a;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            color: white;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .popup-header h2 {
            margin: 0;
            color: rgb(224,190,82);
        }

        .btn-fechar {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        .btn-fechar:hover {
            color: rgb(224,190,82);
        }

        .popup-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-cancelar {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-cancelar:hover {
            background-color: #5a6268;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        .logo-container img {
            max-height: 100px;
            width: auto;
        }

        .padreador-premios {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #333;
        }

        .padreador-premios h4 {
            margin: 0 0 0.8rem 0;
            color: white;
            font-size: 1rem;
            font-weight: bold;
        }

        .padreador-premios ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .padreador-premios li {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            color: white;
        }

        .padreador-premios li i {
            color: rgb(224,190,82);
            width: 16px;
            text-align: center;
        }

        .usuario-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .usuario-info i {
            color: rgb(224,190,82);
            font-size: 1.5rem;
        }

        body {
            opacity: 1;
            visibility: visible;
        }

        /* Criar um overlay de carregamento */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-spinner {
            color: rgb(224,190,82);
            font-size: 2rem;
        }

        .linhagem-info {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(224,190,82,0.2);
        }

        .linhagem-info h4 {
            color: rgb(224,190,82);
            margin: 0 0 0.5rem 0;
        }

        .linhagem-info p {
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.4;
            color: white;
        }

        .mensagem-vazio {
            width: 100%;
            text-align: center;
            padding: 2rem;
            color: #999;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <!-- Adicionar overlay de carregamento -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
    </div>

    <header>
        <div class="logo-container">
            <img src="./img/logo.png" alt="Logo do Gatil">
        </div>
        <button class="menu-toggle" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <nav>
            <ul>
                <li><a href="index.html">Nossos Gatos</a></li>
                <li><a href="matrizes.html">Matrizes</a></li>
                <li><a href="padreadores.html">Padreadores</a></li>
                <li><a href="vendidos.html">Vendidos</a></li>
                <li><a href="contato.html">Sobre & Contato</a></li>
                <li><a href="login.html"><i class="fas fa-user-lock"></i> √Årea Admin</a></li>
            </ul>
        </nav>
        <div class="menu-overlay"></div>
    </header>

    <main>
        <div class="admin-container">
            <div class="admin-header">
                <div class="admin-user-info">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <h3 id="usuario-nome">Administrador</h3>
                        <small id="usuario-tipo">Administrador</small>
                    </div>
                </div>
                <button id="btn-logout" class="btn-excluir">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>

            <div class="admin-tabs">
                <button class="tab-button active" data-tab="gatos">
                    <i class="fas fa-cat"></i> Gatos
                </button>
                <button class="tab-button" data-tab="matrizes">
                    <i class="fas fa-venus"></i> Matrizes
                </button>
                <button class="tab-button" data-tab="padreadores">
                    <i class="fas fa-mars"></i> Padreadores
                </button>
                <button class="tab-button" data-tab="usuarios">
                    <i class="fas fa-users"></i> Usu√°rios
                </button>
            </div>

            <!-- Aba de Gatos -->
            <div id="gatos" class="tab-content active">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Novo Gato</h2>
                    <div id="gato-success" class="success-message">
                        Gato cadastrado com sucesso!
                    </div>
                    <form id="form-novo-gato" class="form-contato">
                        <div class="form-group">
                            <label for="gato-nome">Nome:</label>
                            <input type="text" id="gato-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="gato-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-cor">Cor:</label>
                            <input type="text" id="gato-cor" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-foto">URL da Foto:</label>
                            <input type="text" id="gato-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="gato-descricao">Descri√ß√£o:</label>
                            <textarea id="gato-descricao" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="gato-status">Status:</label>
                            <select id="gato-status" required>
                                <option value="disponivel">Dispon√≠vel</option>
                                <option value="vendido">Vendido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gato-mae">Matriz:</label>
                            <select id="gato-mae" required></select>
                        </div>
                        <div class="form-group">
                            <label for="gato-pai">Padreador:</label>
                            <select id="gato-pai" required></select>
                        </div>
                        <div class="form-group">
                            <label>Tags de Sa√∫de:</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="tag-vacinado" checked> Vacinado
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-vermifugado" checked> Vermifugado
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-microchipado" checked> Microchipado
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-castrado"> Castrado
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Personalidade:</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="tag-docil"> D√≥cil
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-brincalhao"> Brincalh√£o
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-sociavel"> Soci√°vel
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-calmo"> Calmo
                                </label>
                                <label>
                                    <input type="checkbox" id="tag-independente"> Independente
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Gato</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Gatos Cadastrados</h2>
                <div id="gatos-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Matrizes -->
            <div id="matrizes" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Nova Matriz</h2>
                    <div id="matriz-success" class="success-message">
                        Matriz cadastrada com sucesso!
                    </div>
                    <form id="form-nova-matriz" class="form-contato">
                        <div class="form-group">
                            <label for="matriz-nome">Nome:</label>
                            <input type="text" id="matriz-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="matriz-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-raca">Ra√ßa:</label>
                            <input type="text" id="matriz-raca" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-ninhadas">Ninhadas:</label>
                            <input type="number" id="matriz-ninhadas" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-caracteristicas">Caracter√≠sticas dos Filhotes:</label>
                            <textarea id="matriz-caracteristicas" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="matriz-foto">URL da Foto:</label>
                            <input type="text" id="matriz-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="matriz-linhagem">Linhagem:</label>
                            <textarea id="matriz-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Matriz</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Matrizes Cadastradas</h2>
                <div id="matrizes-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Padreadores -->
            <div id="padreadores" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-plus-circle"></i> Novo Padreador</h2>
                    <div id="padreador-success" class="success-message">
                        Padreador cadastrado com sucesso!
                    </div>
                    <form id="form-novo-padreador" class="form-contato">
                        <div class="form-group">
                            <label for="padreador-nome">Nome:</label>
                            <input type="text" id="padreador-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-data-nascimento">Data de Nascimento:</label>
                            <input type="date" id="padreador-data-nascimento" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-raca">Ra√ßa:</label>
                            <input type="text" id="padreador-raca" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-caracteristicas">Caracter√≠sticas dos Filhotes:</label>
                            <textarea id="padreador-caracteristicas" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="padreador-foto">URL da Foto:</label>
                            <input type="text" id="padreador-foto" required>
                        </div>
                        <div class="form-group">
                            <label for="padreador-linhagem">Linhagem:</label>
                            <textarea id="padreador-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Padreador</button>
                    </form>
                </div>
                <h2><i class="fas fa-list"></i> Padreadores Cadastrados</h2>
                <div id="padreadores-grid" class="grid-container"></div>
            </div>

            <!-- Aba de Usu√°rios -->
            <div id="usuarios" class="tab-content">
                <div class="form-section">
                    <h2><i class="fas fa-user-plus"></i> Novo Usu√°rio</h2>
                    <div id="usuario-success" class="success-message">
                        Usu√°rio cadastrado com sucesso!
                    </div>
                    <form id="form-novo-usuario" class="form-contato">
                        <div class="form-group">
                            <label for="novo-nome">Nome:</label>
                            <input type="text" id="novo-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-username">Usu√°rio:</label>
                            <input type="text" id="novo-username" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-password">Senha:</label>
                            <input type="password" id="novo-password" required>
                        </div>
                        <div class="form-group">
                            <label for="novo-tipo">Tipo:</label>
                            <select id="novo-tipo" required>
                                <option value="admin">Administrador</option>
                                <option value="usuario">Usu√°rio</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-enviar">Cadastrar Usu√°rio</button>
                    </form>
                </div>
                <h2><i class="fas fa-users"></i> Usu√°rios Cadastrados</h2>
                <div id="usuarios-grid" class="grid-container"></div>
            </div>
        </div>
    </main>

    <!-- Popup de Edi√ß√£o -->
    <div id="popup-editar" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Gato</h2>
                <button class="btn-fechar" onclick="fecharPopupEditar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-gato" class="form-contato">
                <input type="hidden" id="editar-gato-id">
                <div class="form-group">
                    <label for="editar-gato-nome">Nome:</label>
                    <input type="text" id="editar-gato-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-gato-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-cor">Cor:</label>
                    <input type="text" id="editar-gato-cor" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-foto">URL da Foto:</label>
                    <input type="text" id="editar-gato-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-gato-descricao">Descri√ß√£o:</label>
                    <textarea id="editar-gato-descricao" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-gato-status">Status:</label>
                    <select id="editar-gato-status" required>
                        <option value="disponivel">Dispon√≠vel</option>
                        <option value="vendido">Vendido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editar-gato-mae">Matriz:</label>
                    <select id="editar-gato-mae" required></select>
                </div>
                <div class="form-group">
                    <label for="editar-gato-pai">Padreador:</label>
                    <select id="editar-gato-pai" required></select>
                </div>
                <div class="form-group">
                    <label>Tags de Sa√∫de:</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="editar-tag-vacinado"> Vacinado
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-vermifugado"> Vermifugado
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-microchipado"> Microchipado
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-castrado"> Castrado
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Personalidade:</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="editar-tag-docil"> D√≥cil
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-brincalhao"> Brincalh√£o
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-sociavel"> Soci√°vel
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-calmo"> Calmo
                        </label>
                        <label>
                            <input type="checkbox" id="editar-tag-independente"> Independente
                        </label>
                    </div>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditar()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup de Edi√ß√£o de Matriz -->
    <div id="popup-editar-matriz" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Matriz</h2>
                <button class="btn-fechar" onclick="fecharPopupEditarMatriz()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-matriz" class="form-contato">
                <input type="hidden" id="editar-matriz-id">
                <div class="form-group">
                    <label for="editar-matriz-nome">Nome:</label>
                    <input type="text" id="editar-matriz-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-matriz-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-raca">Ra√ßa:</label>
                    <input type="text" id="editar-matriz-raca" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-ninhadas">Ninhadas:</label>
                    <input type="number" id="editar-matriz-ninhadas" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-caracteristicas">Caracter√≠sticas dos Filhotes:</label>
                    <textarea id="editar-matriz-caracteristicas" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-foto">URL da Foto:</label>
                    <input type="text" id="editar-matriz-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-matriz-linhagem">Linhagem:</label>
                    <textarea id="editar-matriz-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditarMatriz()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup de Edi√ß√£o de Padreador -->
    <div id="popup-editar-padreador" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2><i class="fas fa-edit"></i> Editar Padreador</h2>
                <button class="btn-fechar" onclick="fecharPopupEditarPadreador()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-padreador" class="form-contato">
                <input type="hidden" id="editar-padreador-id">
                <div class="form-group">
                    <label for="editar-padreador-nome">Nome:</label>
                    <input type="text" id="editar-padreador-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-data-nascimento">Data de Nascimento:</label>
                    <input type="date" id="editar-padreador-data-nascimento" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-raca">Ra√ßa:</label>
                    <input type="text" id="editar-padreador-raca" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-caracteristicas">Caracter√≠sticas dos Filhotes:</label>
                    <textarea id="editar-padreador-caracteristicas" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-foto">URL da Foto:</label>
                    <input type="text" id="editar-padreador-foto" required>
                </div>
                <div class="form-group">
                    <label for="editar-padreador-linhagem">Linhagem:</label>
                    <textarea id="editar-padreador-linhagem" required placeholder="Descreva a linhagem do animal..."></textarea>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn-cancelar" onclick="fecharPopupEditarPadreador()">Cancelar</button>
                    <button type="submit" class="btn-enviar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Zaidan Gatil. Todos os direitos reservados.</p>
    </footer>

    <script src="menu.js"></script>
    <script>
        // Fun√ß√£o para mostrar/esconder o overlay de carregamento
        function toggleLoading(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
        }

        // Fun√ß√£o para verificar a sess√£o
        async function verificarSessao() {
            try {
                const response = await fetch('verificar_sessao.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    },
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    throw new Error('Erro na resposta do servidor');
                }

                const data = await response.json();

                if (!data.logado) {
                    window.location.href = 'login.html';
                    return false;
                }
                
                // Atualiza o nome do usu√°rio no header
                document.getElementById('usuario-nome').textContent = data.nome || 'Administrador';
                document.getElementById('usuario-tipo').textContent = data.tipo === 'admin' ? 'Administrador' : 'Usu√°rio';
                
                return true;

            } catch (error) {
                console.error('Erro ao verificar sess√£o:', error);
                window.location.href = 'login.html';
                return false;
            }
        }

        // Inicializa√ß√£o da p√°gina
        async function inicializarPagina() {
            try {
                toggleLoading(true);
                const sessaoValida = await verificarSessao();
                
                if (!sessaoValida) {
                    return;
                }

                // Carrega os dados apenas se a sess√£o for v√°lida
                await Promise.all([
                    carregarUsuarios(),
                    atualizarListaGatos(),
                    atualizarListaMatrizes(),
                    atualizarListaPadreadores()
                ]);

            } catch (error) {
                console.error('Erro ao inicializar p√°gina:', error);
                window.location.href = 'login.html';
            } finally {
                toggleLoading(false);
            }
        }

        // Adicionar evento para inicializar a p√°gina quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', inicializarPagina);

        // Modificar fun√ß√£o de logout
        document.getElementById('btn-logout').addEventListener('click', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            try {
                const response = await fetch('logout.php', {
                    method: 'POST',
                    credentials: 'include',
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao fazer logout');
                }

                const data = await response.json();

                if (data.success) {
                    // Limpar os storages
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
                window.location.href = 'login.html';
            }
        });

        // Gerenciamento de abas
        const tabs = document.querySelectorAll('.tab-button');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                
                // Atualizar bot√µes
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Atualizar conte√∫do
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Modifica o evento de submit do formul√°rio de novo usu√°rio
        document.getElementById('form-novo-usuario').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const novoUsuario = {
                nome: document.getElementById('novo-nome').value,
                username: document.getElementById('novo-username').value,
                password: document.getElementById('novo-password').value,
                tipo: document.getElementById('novo-tipo').value
            };

            try {
                const response = await fetch('cadastrar_usuario.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(novoUsuario)
                });

                const data = await response.json();
                
                if (data.success) {
                    // Limpa o formul√°rio
                    e.target.reset();
                    
                    // Mostra mensagem de sucesso
                    document.getElementById('usuario-success').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('usuario-success').style.display = 'none';
                    }, 3000);
                    
                    // Recarrega a lista de usu√°rios
                    await carregarUsuarios();
                } else {
                    alert(data.message || 'Erro ao cadastrar usu√°rio');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar usu√°rio');
            } finally {
                toggleLoading(false);
            }
        });

        // Fun√ß√£o para carregar usu√°rios do banco de dados
        async function carregarUsuarios() {
            try {
                const response = await fetch('buscar_usuarios.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Cache-Control': 'no-cache'
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao buscar usu√°rios');
                }

                const data = await response.json();
                
                if (data.success) {
                    atualizarListaUsuarios(data.usuarios);
                } else {
                    throw new Error(data.message || 'Erro ao buscar usu√°rios');
                }
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                if (error.message.includes('n√£o autorizado')) {
                    window.location.href = 'login.html';
                }
            }
        }

        // Fun√ß√£o para atualizar a lista de usu√°rios
        function atualizarListaUsuarios(usuarios) {
            const usuariosGrid = document.getElementById('usuarios-grid');
            usuariosGrid.innerHTML = '';

            usuarios.forEach(usuario => {
                const usuarioCard = document.createElement('div');
                usuarioCard.className = 'card';
                usuarioCard.innerHTML = `
                    <div class="usuario-info">
                        <i class="fas fa-user"></i>
                        <div>
                            <h3>${usuario.name}</h3>
                            <small>${usuario.user} - ${usuario.type === 'admin' ? 'Administrador' : 'Usu√°rio'}</small>
                        </div>
                    </div>
                    ${usuario.user !== 'adminamaral' ? `
                        <div class="card-actions">
                            <button class="btn-excluir" onclick="excluirUsuario(${usuario.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                `;
                usuariosGrid.appendChild(usuarioCard);
            });
        }

        // Fun√ß√£o para excluir usu√°rio
        async function excluirUsuario(id) {
            if (!confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                return;
            }

            toggleLoading(true);

            try {
                const response = await fetch('excluir_usuario.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ id: id })
                });

                const data = await response.json();
                
                if (data.success) {
                    await carregarUsuarios();
                } else {
                    alert(data.message || 'Erro ao excluir usu√°rio');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao excluir usu√°rio');
            } finally {
                toggleLoading(false);
            }
        }

        // Fun√ß√µes de atualiza√ß√£o das listas
        async function atualizarListaGatos() {
            try {
                const response = await fetch('buscar_gatos.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao buscar gatos');
                }

                const data = await response.json();
                
                if (data.success) {
                    const gatosGrid = document.getElementById('gatos-grid');
                    gatosGrid.innerHTML = '';

                    if (!data.gatos || data.gatos.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.innerHTML = '<p>Nenhum gato cadastrado</p>';
                        gatosGrid.appendChild(mensagem);
                        return;
                    }

                    data.gatos.forEach(gato => {
                        const idade = calcularIdade(gato.data_nascimento);
                        const gatoCard = document.createElement('div');
                        gatoCard.className = 'card';
                        gatoCard.innerHTML = `
                            <img src="${gato.foto}" alt="${gato.nome}">
                            <h3>${gato.nome}</h3>
                            <p>${idade} - ${gato.cor}</p>
                            <div class="tags-container">
                                ${gato.saude.map(tag => `<span class="tag tag-saude"><i class="fas fa-heart"></i> ${tag}</span>`).join('')}
                                ${gato.personalidade.map(tag => `<span class="tag tag-personalidade"><i class="fas fa-smile"></i> ${tag}</span>`).join('')}
                            </div>
                            <span class="status-badge status-${gato.status}">
                                ${gato.status === 'disponivel' ? 'Dispon√≠vel' : 'Vendido'}
                                ${gato.data_venda ? `<br>Vendido em: ${formatarData(gato.data_venda)}` : ''}
                            </span>
                            <div class="card-actions">
                                <button class="btn-editar" onclick="editarGato(${gato.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-excluir" onclick="excluirGato(${gato.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        gatosGrid.appendChild(gatoCard);
                    });
                } else {
                    throw new Error(data.message || 'Erro ao buscar gatos');
                }
            } catch (error) {
                console.error('Erro ao carregar gatos:', error);
                alert('Erro ao carregar gatos: ' + error.message);
            }
        }

        async function atualizarListaMatrizes() {
            try {
                const response = await fetch('buscar_matrizes.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao buscar matrizes');
                }

                const data = await response.json();
                
                if (data.success) {
                    const matrizesGrid = document.getElementById('matrizes-grid');
                    matrizesGrid.innerHTML = '';

                    if (!data.matrizes || data.matrizes.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.innerHTML = '<p>Nenhuma matriz cadastrada</p>';
                        matrizesGrid.appendChild(mensagem);
                        return;
                    }

                    data.matrizes.forEach(matriz => {
                        const idade = calcularIdade(matriz.data_nascimento);
                        const matrizCard = document.createElement('div');
                        matrizCard.className = 'card';
                        matrizCard.innerHTML = `
                            <img src="${matriz.foto}" alt="${matriz.nome}">
                            <h3>${matriz.nome}</h3>
                            <p>Data de Nascimento: ${formatarData(matriz.data_nascimento)}</p>
                            <p>Ra√ßa: ${matriz.raca}</p>
                            <p>Ninhadas: ${matriz.ninhadas}</p>
                            <p>Total de Filhotes: ${matriz.total_filhotes}</p>
                            <div class="linhagem-info">
                                <h4>Linhagem:</h4>
                                <p>${matriz.linhagem || 'N√£o informada'}</p>
                            </div>
                            <div class="card-actions">
                                <button class="btn-editar" onclick="editarMatriz(${matriz.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-excluir" onclick="excluirMatriz(${matriz.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        matrizesGrid.appendChild(matrizCard);
                    });
                } else {
                    throw new Error(data.message || 'Erro ao buscar matrizes');
                }
            } catch (error) {
                console.error('Erro ao carregar matrizes:', error);
                alert('Erro ao carregar matrizes: ' + error.message);
            }
        }

        async function atualizarListaPadreadores() {
            try {
                const response = await fetch('buscar_padreadores.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao buscar padreadores');
                }

                const data = await response.json();
                
                if (data.success) {
                    const padreadoresGrid = document.getElementById('padreadores-grid');
                    padreadoresGrid.innerHTML = '';

                    if (!data.padreadores || data.padreadores.length === 0) {
                        const mensagem = document.createElement('div');
                        mensagem.className = 'mensagem-vazio';
                        mensagem.innerHTML = '<p>Nenhum padreador cadastrado</p>';
                        padreadoresGrid.appendChild(mensagem);
                        return;
                    }

                    data.padreadores.forEach(padreador => {
                        const idade = calcularIdade(padreador.data_nascimento);
                        const padreadorCard = document.createElement('div');
                        padreadorCard.className = 'card';
                        padreadorCard.innerHTML = `
                            <img src="${padreador.foto}" alt="${padreador.nome}">
                            <h3>${padreador.nome}</h3>
                            <p>Data de Nascimento: ${formatarData(padreador.data_nascimento)}</p>
                            <p>Ra√ßa: ${padreador.raca}</p>
                            <p>Total de Filhotes: ${padreador.total_filhotes}</p>
                            <div class="linhagem-info">
                                <h4>Linhagem:</h4>
                                <p>${padreador.linhagem || 'N√£o informada'}</p>
                            </div>
                            <div class="card-actions">
                                <button class="btn-editar" onclick="editarPadreador(${padreador.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-excluir" onclick="excluirPadreador(${padreador.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        padreadoresGrid.appendChild(padreadorCard);
                    });
                } else {
                    throw new Error(data.message || 'Erro ao buscar padreadores');
                }
            } catch (error) {
                console.error('Erro ao carregar padreadores:', error);
                alert('Erro ao carregar padreadores: ' + error.message);
            }
        }

        // Fun√ß√µes de exclus√£o
        window.excluirGato = function(nome) {
            if (confirm('Tem certeza que deseja excluir este gato?')) {
                gatos = gatos.filter(g => g.nome !== nome);
                localStorage.setItem('gatos', JSON.stringify(gatos));
                atualizarListaGatos();
            }
        };

        window.excluirMatriz = function(nome) {
            if (confirm('Tem certeza que deseja excluir esta matriz?')) {
                matrizes = matrizes.filter(m => m.nome !== nome);
                localStorage.setItem('matrizes', JSON.stringify(matrizes));
                atualizarListaMatrizes();
            }
        };

        window.excluirPadreador = function(nome) {
            if (confirm('Tem certeza que deseja excluir este padreador?')) {
                padreadores = padreadores.filter(p => p.nome !== nome);
                localStorage.setItem('padreadores', JSON.stringify(padreadores));
                atualizarListaPadreadores();
            }
        };

        // Fun√ß√µes para o popup de edi√ß√£o
        window.editarGato = function(nome) {
            const gato = gatos.find(g => g.nome === nome);
            if (!gato) return;

            // Preencher o formul√°rio com os dados do gato
            document.getElementById('editar-gato-id').value = nome;
            document.getElementById('editar-gato-nome').value = gato.nome;
            document.getElementById('editar-gato-data-nascimento').value = gato.dataNascimento;
            document.getElementById('editar-gato-cor').value = gato.cor;
            document.getElementById('editar-gato-foto').value = gato.foto;
            document.getElementById('editar-gato-descricao').value = gato.descricao || '';
            document.getElementById('editar-gato-status').value = gato.status || 'disponivel';
            document.getElementById('editar-gato-mae').value = gato.pais?.mae || '';
            document.getElementById('editar-gato-pai').value = gato.pais?.pai || '';

            // Marcar checkboxes de sa√∫de
            document.getElementById('editar-tag-vacinado').checked = gato.saude?.includes('Vacinado');
            document.getElementById('editar-tag-vermifugado').checked = gato.saude?.includes('Vermifugado');
            document.getElementById('editar-tag-microchipado').checked = gato.saude?.includes('Microchipado');
            document.getElementById('editar-tag-castrado').checked = gato.saude?.includes('Castrado');

            // Marcar checkboxes de personalidade
            document.getElementById('editar-tag-docil').checked = gato.personalidade?.includes('D√≥cil');
            document.getElementById('editar-tag-brincalhao').checked = gato.personalidade?.includes('Brincalh√£o');
            document.getElementById('editar-tag-sociavel').checked = gato.personalidade?.includes('Soci√°vel');
            document.getElementById('editar-tag-calmo').checked = gato.personalidade?.includes('Calmo');
            document.getElementById('editar-tag-independente').checked = gato.personalidade?.includes('Independente');

            // Preencher selects de matrizes e padreadores
            const selectMae = document.getElementById('editar-gato-mae');
            const selectPai = document.getElementById('editar-gato-pai');
            
            selectMae.innerHTML = '<option value="">Selecione uma matriz</option>';
            selectPai.innerHTML = '<option value="">Selecione um padreador</option>';
            
            matrizes.forEach(matriz => {
                selectMae.innerHTML += `<option value="${matriz.nome}">${matriz.nome} (${matriz.raca})</option>`;
            });
            
            padreadores.forEach(padreador => {
                selectPai.innerHTML += `<option value="${padreador.nome}">${padreador.nome} (${padreador.raca})</option>`;
            });

            // Selecionar os pais atuais
            if (gato.pais?.mae) selectMae.value = gato.pais.mae;
            if (gato.pais?.pai) selectPai.value = gato.pais.pai;

            // Mostrar o popup
            document.getElementById('popup-editar').style.display = 'block';
        };

        window.fecharPopupEditar = function() {
            document.getElementById('popup-editar').style.display = 'none';
        };

        // Evento de submit do formul√°rio de edi√ß√£o
        document.getElementById('form-editar-gato').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nomeAntigo = document.getElementById('editar-gato-id').value;
            const gatoIndex = gatos.findIndex(g => g.nome === nomeAntigo);
            
            if (gatoIndex === -1) return;

            const saude = [];
            if (document.getElementById('editar-tag-vacinado').checked) saude.push('Vacinado');
            if (document.getElementById('editar-tag-vermifugado').checked) saude.push('Vermifugado');
            if (document.getElementById('editar-tag-microchipado').checked) saude.push('Microchipado');
            if (document.getElementById('editar-tag-castrado').checked) saude.push('Castrado');

            const personalidade = [];
            if (document.getElementById('editar-tag-docil').checked) personalidade.push('D√≥cil');
            if (document.getElementById('editar-tag-brincalhao').checked) personalidade.push('Brincalh√£o');
            if (document.getElementById('editar-tag-sociavel').checked) personalidade.push('Soci√°vel');
            if (document.getElementById('editar-tag-calmo').checked) personalidade.push('Calmo');
            if (document.getElementById('editar-tag-independente').checked) personalidade.push('Independente');

            const novoStatus = document.getElementById('editar-gato-status').value;
            const gatoAtual = gatos[gatoIndex];
            let dataVenda = gatoAtual.dataVenda;

            // Atualiza a data de venda apenas se o status mudou para vendido
            if (novoStatus === 'vendido' && gatoAtual.status !== 'vendido') {
                dataVenda = new Date().toLocaleDateString('pt-BR');
            } else if (novoStatus !== 'vendido') {
                dataVenda = null;
            }

            const gatoAtualizado = {
                nome: document.getElementById('editar-gato-nome').value,
                dataNascimento: document.getElementById('editar-gato-data-nascimento').value,
                cor: document.getElementById('editar-gato-cor').value,
                foto: document.getElementById('editar-gato-foto').value,
                descricao: document.getElementById('editar-gato-descricao').value,
                status: novoStatus,
                dataVenda: dataVenda,
                pais: {
                    mae: document.getElementById('editar-gato-mae').value,
                    pai: document.getElementById('editar-gato-pai').value
                },
                saude: saude,
                personalidade: personalidade
            };

            gatos[gatoIndex] = gatoAtualizado;
            localStorage.setItem('gatos', JSON.stringify(gatos));
            
            fecharPopupEditar();
            atualizarListaGatos();
        });

        // Fechar popup ao clicar fora
        document.getElementById('popup-editar').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditar();
            }
        });

        // Fun√ß√µes para o popup de edi√ß√£o de matriz
        window.editarMatriz = function(id) {
            toggleLoading(true);
            
            fetch(`buscar_matriz.php?id=${id}`, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao buscar dados da matriz');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    const matriz = data.matriz;
                    
                    document.getElementById('editar-matriz-id').value = matriz.id;
                    document.getElementById('editar-matriz-nome').value = matriz.nome;
                    document.getElementById('editar-matriz-data-nascimento').value = matriz.data_nascimento;
                    document.getElementById('editar-matriz-raca').value = matriz.raca;
                    document.getElementById('editar-matriz-ninhadas').value = matriz.ninhadas;
                    document.getElementById('editar-matriz-caracteristicas').value = matriz.caracteristicas_filhotes;
                    document.getElementById('editar-matriz-foto').value = matriz.foto;
                    document.getElementById('editar-matriz-linhagem').value = matriz.linhagem;

                    document.getElementById('popup-editar-matriz').style.display = 'block';
                } else {
                    alert(data.message || 'Erro ao buscar dados da matriz');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao buscar dados da matriz');
            })
            .finally(() => {
                toggleLoading(false);
            });
        };

        // Evento de submit do formul√°rio de edi√ß√£o de matriz
        document.getElementById('form-editar-matriz').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const matrizAtualizada = {
                id: document.getElementById('editar-matriz-id').value,
                nome: document.getElementById('editar-matriz-nome').value,
                data_nascimento: document.getElementById('editar-matriz-data-nascimento').value,
                raca: document.getElementById('editar-matriz-raca').value,
                ninhadas: document.getElementById('editar-matriz-ninhadas').value,
                caracteristicas: document.getElementById('editar-matriz-caracteristicas').value,
                foto: document.getElementById('editar-matriz-foto').value,
                linhagem: document.getElementById('editar-matriz-linhagem').value
            };

            try {
                const response = await fetch('editar_matriz.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(matrizAtualizada)
                });

                const data = await response.json();
                
                if (data.success) {
                    // Fecha o popup
                    fecharPopupEditarMatriz();
                    
                    // Recarrega a lista de matrizes
                    await atualizarListaMatrizes();
                    
                    alert('Matriz atualizada com sucesso!');
                } else {
                    alert(data.message || 'Erro ao atualizar matriz');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar matriz');
            } finally {
                toggleLoading(false);
            }
        });

        // Fun√ß√£o para excluir matriz
        window.excluirMatriz = function(id) {
            if (!confirm('Tem certeza que deseja excluir esta matriz?')) {
                return;
            }

            toggleLoading(true);

            fetch('excluir_matriz.php', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ id: id })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    atualizarListaMatrizes();
                } else {
                    alert(data.message || 'Erro ao excluir matriz');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao excluir matriz');
            })
            .finally(() => {
                toggleLoading(false);
            });
        };

        // Fun√ß√µes para o popup de edi√ß√£o de padreador
        window.editarPadreador = function(nome) {
            const padreador = padreadores.find(p => p.nome === nome);
            if (!padreador) return;

            document.getElementById('editar-padreador-id').value = nome;
            document.getElementById('editar-padreador-nome').value = padreador.nome;
            document.getElementById('editar-padreador-data-nascimento').value = padreador.dataNascimento;
            document.getElementById('editar-padreador-raca').value = padreador.raca;
            document.getElementById('editar-padreador-caracteristicas').value = padreador.caracteristicasFilhotes;
            document.getElementById('editar-padreador-foto').value = padreador.foto;
            document.getElementById('editar-padreador-linhagem').value = padreador.linhagem;

            document.getElementById('popup-editar-padreador').style.display = 'block';
        };

        window.fecharPopupEditarPadreador = function() {
            document.getElementById('popup-editar-padreador').style.display = 'none';
        };

        // Evento de submit do formul√°rio de edi√ß√£o de padreador
        document.getElementById('form-editar-padreador').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nomeAntigo = document.getElementById('editar-padreador-id').value;
            const novoNome = document.getElementById('editar-padreador-nome').value;
            const padreadorIndex = padreadores.findIndex(p => p.nome === nomeAntigo);
            
            if (padreadorIndex === -1) return;

            const padreadorAtualizado = {
                nome: novoNome,
                dataNascimento: document.getElementById('editar-padreador-data-nascimento').value,
                raca: document.getElementById('editar-padreador-raca').value,
                caracteristicasFilhotes: document.getElementById('editar-padreador-caracteristicas').value,
                foto: document.getElementById('editar-padreador-foto').value,
                linhagem: document.getElementById('editar-padreador-linhagem').value,
                premios: document.getElementById('editar-padreador-premios').value.split('\n').filter(p => p.trim())
            };

            // Atualizar o nome do padreador em todos os gatos descendentes
            if (nomeAntigo !== novoNome) {
                gatos.forEach(gato => {
                    if (gato.pais && gato.pais.pai === nomeAntigo) {
                        gato.pais.pai = novoNome;
                    }
                });
                localStorage.setItem('gatos', JSON.stringify(gatos));
            }

            padreadores[padreadorIndex] = padreadorAtualizado;
            localStorage.setItem('padreadores', JSON.stringify(padreadores));
            
            fecharPopupEditarPadreador();
            atualizarListaPadreadores();
            preencherSelectsPais();
        });

        // Fechar popups ao clicar fora
        document.getElementById('popup-editar-matriz').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditarMatriz();
            }
        });

        document.getElementById('popup-editar-padreador').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharPopupEditarPadreador();
            }
        });

        // Adicionar fun√ß√µes auxiliares para formata√ß√£o de data e c√°lculo de idade
        function calcularIdade(dataNascimento) {
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            
            if (idade < 1) {
                const meses = idade * 12 + mes;
                return `${meses} meses`;
            }
            
            return `${idade} anos`;
        }

        function formatarData(data) {
            if (!data) return '';
            const d = new Date(data);
            return d.toLocaleDateString('pt-BR');
        }

        // Evento de submit do formul√°rio de nova matriz
        document.getElementById('form-nova-matriz').addEventListener('submit', async function(e) {
            e.preventDefault();
            toggleLoading(true);
            
            const novaMatriz = {
                nome: document.getElementById('matriz-nome').value,
                data_nascimento: document.getElementById('matriz-data-nascimento').value,
                raca: document.getElementById('matriz-raca').value,
                ninhadas: document.getElementById('matriz-ninhadas').value,
                caracteristicas: document.getElementById('matriz-caracteristicas').value,
                foto: document.getElementById('matriz-foto').value,
                linhagem: document.getElementById('matriz-linhagem').value
            };

            try {
                const response = await fetch('cadastrar_matriz.php', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(novaMatriz)
                });

                const data = await response.json();
                
                if (data.success) {
                    // Limpa o formul√°rio
                    e.target.reset();
                    
                    // Mostra mensagem de sucesso
                    document.getElementById('matriz-success').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('matriz-success').style.display = 'none';
                    }, 3000);
                    
                    // Recarrega a lista de matrizes
                    await atualizarListaMatrizes();
                } else {
                    alert(data.message || 'Erro ao cadastrar matriz');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar matriz');
            } finally {
                toggleLoading(false);
            }
        });

        window.fecharPopupEditarMatriz = function() {
            document.getElementById('popup-editar-matriz').style.display = 'none';
        };
    </script>
</body>
</html>